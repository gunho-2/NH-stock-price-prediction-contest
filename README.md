# NH-stock-price-prediction-contest
NH 투자증권에서 개최한 공모전으로, NH에서 제공하는 내부 데이터를 기반으로 고객들이 주식을 얼마나 보유할지 예측하는 모델을 설계하는 프로젝트 (2021.09 ~ 2021.11)

**데이터는 공개하지 않음**

## 예측 모델에 대한 개발 설명 
 - 주식 시장은 하루가 다르게 변하며, 많은 소비자는 수 많은 정보에 의해 해당 주식을 사고 팔며 다양한 행동을 행한다. 그러나, 은행사는 또 하나의 기업이므로, Brand loyalty & Customer loyalty(브랜드 충성 및 소비자 충성)을 쌓을 수 있는 고객의 양성을 필요로 할 것이고, 이를 위해서는 다양한 고객행동의 분석을 통한 충성 고객의 검출과, 이에 따른 충성 고객층을 굳히기 위한 집중적인 마케팅을 필요로 할 것이다. 따라서, 본 프로젝트에서는 실제 데이터를 통해, 충성 고객은 평균 며칠정도의 거래를 유지하는 지의 내역을 통해 어떤 고객이 우리 은행의 집중적인 충성 고객(loyalty customer)이 되어 집중 마케팅의 대상이 되는지, 혹은 상대적으로 마케팅 대상에서 무분별한 마케팅 비용 소비의 대상에서 벗어날 수 있는지에 대해 집중적으로 탐구하는 것을 목표로 한다.
 
 ### A. 분석 배경 및 과정
 - 본 프로젝트에서는 주어진 데이터 이외에, 해당 기간의 개장일 데이터 및 개장일 간의 주가 데이터를 추가로 크롤링 및 수집하였다.
 - crawling을 통해 수집한 주가 데이터를 활용하여 주식과 관련된 대표적인 지수인 RSI, MFI를 파생변수로 추가한다.그 근거는 다음과 같다.
    1. 주식에 있어 소비자의 행동에 영향을 미치는 요소는 그야말로 "주가"일 것으로 판단된다. 따라서, 소비자행동에 영향을 미치는 해당일의 장의 마감 가격(즉, 종가)를 기준으로 평가할 수 있는 "RSI" 변수를 파생변수로 추가
    2. 그러나, "종가" 이외에 실제 주식 시장에서 소비자행동에 영향을 미칠 수 있는 것은 다양한 주식의 가격("시가" 등)일 수 있기에, "RSI"뿐 아닌, "MFI" 변수를 파생변수로 추가
- 이외의 파생변수는 주어진 데이터를 기반으로 하여 생성하였으며, 이 근거는 주로 탐색적 데이터 분석에서 얻은 Insight에 의해 진행되었다. 
EDA 과정에서 얻은 Insight를 활용하여, 주식 보유기간(~2020. 12. 31. 기간 제한)에서 해당 주식의 보유기간이 10일 미만인지 아닌지의 여부(under_10)와, 해당 고객의 해당 종목의 과거 주식 투자 이력 횟수(count)를 생성한다.
- 우리가 다루고자 하는 바는 회귀 모형(주식 보유기간 즉, 'hold_d'가 어느 정도일까?)이므로, 독립변수 또한 범주형 변수보다는, 수치형 변수가 예측에 도움이 될 것이라 생각된다. 따라서, 수 많은 indicator variable(지시 변수)를 모두 수치형 변수로 대체하였다.(각 범주별 hold_d(훈련집합의 경우), hist_d(평가집합의 경우)의 평균값으로 해당 값을 대체하였음.)

### B. 분석의 범주 
 - 분석 기간은 주최측에서 제시한 대로, 2021년 7월 31일으로 삼는다.
 - 주어진 데이터는 2020년 12월 31일까지이지만 우리의 목표는 2021년 7월 31일까지로, 해당 기간까지의 주식 보유기간의 예측을 목표로 한 것이기 때문에 2021년 7월 31일까지로 분석의 목표로 삼는다.
  - 따라서, 아무리 뛰어난 성능을 보일지라도 hold_d - hist_d <= 146의 제약조건을 만족시키는 범위 내(제약조건 만족)에서 분석 최종 목표치를 삼을 예정이다.

### C. 모델링 진행 및 중요한 가정
 - 앞선 A번과 B번의 내용에 근거하여 최종데이터는 under_10(dummy variable)을 제외한 모든 변수가 수치형자료이므로, 이렇게 수 많은 범주형 변수를 수치형 변수로 변환하는 것이 회귀 문제를 해결하기에 최적임을 가정하였고 실제 모델 성능도 우수하였음.
 - 모든 변수가 hold_d 및 hist_d에 근거하여 생성되었기 때문에 변수 선택(stepAIC, variable Selection)에 있어 최적의 결과임을 가정함. (실제 반복 실험의 결과 변수선택의 결과보다는 모든 변수를 활용하는 것의 모델 성능이 높았음.)
 - 예측을 진행하기에 앞서, 다양한 모델(Lightgbm, XGboost, RandomForest 등의 ensemble모델 등)의 시도가 있었고, cv(cross validation)의 숫자에 대한 복원실험이 있었으나, 그 결과 가장 효과적인 모델은 LGBM모델와 nfolds=10(k의 갯수 = 10)으로, 최종 결과로 제출한 내용(코드)과 같음.

### D. 모델링에 대한 추가적인 특이사항 
 - 평가집합 상에 존재하는 hist_d 변수를 제외하고, 훈련(학습)을 진행하고, 평가집합에 대한 예측을 진행한다.
 - 데이터 후처리를 통해, 예측 결과와 평가집합 상에서 제외했던 hist_d의 값을 더해 평가집합의 최종 예측값(최종 hold_d)로 정하여 최종 제출(submission.csv)을 진행한다.
 
